import{getInstance}from"/index.js";import{easeInOutQuint}from"/utils/easing.js";import clamp from"/utils/clamp.js";export default class Ouch{static get selector(){return".ouch"}constructor(t){this.block=t,this.animatedWord=t.querySelector(".animated-word"),this.transitionDuration=1e3,this.listeners=[],this.animationStartTimestamp=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.animate=this.animate.bind(this)}onReady(){this.animatedWordInstance=getInstance(this.animatedWord),this.block.style.webkitClipPath="inset(100% 0% 0% 0%)",this.block.style.clipPath="inset(100% 0% 0% 0%)"}animate(){this.block.style.opacity=1,window.requestAnimationFrame(this.show)}show(t){this.animationStartTimestamp||(this.animationStartTimestamp=t);let i=easeInOutQuint(clamp((t-this.animationStartTimestamp)/this.transitionDuration,0,1));this.block.style.webkitClipPath="none",this.block.style.clipPath="none",this.block.style.webkitClipPath=`inset(${100*(1-i)}% 0% 0% 0%)`,this.block.style.clipPath=`inset(${100*(1-i)}% 0% 0% 0%)`,i>.5&&!this.animatedWordInstance.isShowing&&this.animatedWordInstance&&this.animatedWordInstance.show&&this.animatedWordInstance.show(),i<1?this.raf=window.requestAnimationFrame(this.show):(window.cancelAnimationFrame(this.show),this.raf=null,this.animationStartTimestamp=null,window.requestAnimationFrame(this.hide),this.listeners.forEach(t=>{t()}))}hide(t){this.animationStartTimestamp||(this.animationStartTimestamp=t);let i=easeInOutQuint(clamp((t-this.animationStartTimestamp)/this.transitionDuration,0,1));this.block.style.webkitClipPath=`inset(0% 0% ${100*i}% 0%)`,this.block.style.clipPath=`inset(0% 0% ${100*i}% 0%)`,i<1?this.raf=window.requestAnimationFrame(this.hide):(window.cancelAnimationFrame(this.hide),this.raf=null,this.animationStartTimestamp=null,this.onReady(),this.block.style.opacity=0,this.animatedWordInstance&&this.animatedWordInstance.onReady&&this.animatedWordInstance.onReady())}listen(t){this.listeners.push(t)}}